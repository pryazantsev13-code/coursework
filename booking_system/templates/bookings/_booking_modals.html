{% for booking in all_bookings %}
<div class="modal fade" id="bookingModal{{ booking.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-sm">
            <div class="modal-header bg-light bg-opacity-50 border-0">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-edit text-primary me-2"></i>Управление бронированием
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'update_booking_status' booking.id %}" class="booking-status-form">
                {% csrf_token %}
                <div class="modal-body">
                    <!-- Информация о бронировании -->
                    <div class="card border-0 bg-light bg-opacity-25 mb-4">
                        <div class="card-body p-3">
                            <div class="row g-3">
                                <div class="col-6">
                                    <small class="text-muted d-block">Услуга</small>
                                    <div class="fw-medium">{{ booking.service.name }}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted d-block">Клиент</small>
                                    <div class="fw-medium">{{ booking.user.get_full_name|default:booking.user.username }}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted d-block">Дата</small>
                                    <div class="fw-medium">{{ booking.time_slot.date|date:"d.m.Y" }}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted d-block">Время</small>
                                    <div class="fw-medium">{{ booking.time_slot.start_time|time:"H:i" }}</div>
                                </div>
                                <div class="col-12">
                                    <small class="text-muted d-block">Текущий статус</small>
                                    <div>
                                        <span class="badge {% if booking.status == 'confirmed' %}bg-success{% elif booking.status == 'pending' %}bg-warning text-dark{% elif booking.status == 'completed' %}bg-info{% elif booking.status == 'cancelled' %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {{ booking.get_status_display }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Смена статуса -->
                    <div class="mb-4">
                        <label class="form-label fw-medium">Новый статус:</label>
                        <select name="status" class="form-select">
                            {% for status_value, status_name in booking.STATUS_CHOICES %}
                            <option value="{{ status_value }}" {% if booking.status == status_value %}selected{% endif %}>
                                {{ status_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer bg-light bg-opacity-50 border-0">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        Отмена
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Сохранить
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<style>
.modal-content {
    border-radius: 12px;
}
.modal-header {
    border-radius: 12px 12px 0 0;
}
.modal-footer {
    border-radius: 0 0 12px 12px;
}
.form-control, .form-select {
    border-radius: 8px;
}
.card {
    border-radius: 8px;
}
</style>